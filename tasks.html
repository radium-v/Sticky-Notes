<!DOCTYPE HTML>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<title></title>
</head>
<body>
	<button id="authorize-button" style="visibility: hidden">Authorize</button>

	<script type="text/javascript">
		var clientId = '872589437307';
		var apiKey = 'AIzaSyBw8Tm43SHWAsvNkP2TNxhTsaetjlL3fTU';
		var scopes = 'https://www.googleapis.com/auth/tasks';

		function handleClientLoad() {
			gapi.client.setApiKey(apiKey);
			window.setTimeout(checkAuth, 1);
		}

		function checkAuth() {
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
		}

		function handleAuthResult(authResult) {
			var authorizeButton = document.getElementById('authorize-button');

			if (authResult) {
				authorizeButton.style.visibility = 'hidden';
				makeApiCall();
			} else {
				authorizeButton.style.visibility = '';
				authorizeButton.onclick = handleAuthClick;
			}
		}

		function handleAuthClick(event) {
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: false}, handleAuthResult);
			return false;
		}

		function makeApiCall() {
			gapi.client.load('tasks', 'v1', function() {
				var request = gapi.client.tasks.tasklists.list();
				request.execute(function(resp) {

					request = gapi.client.tasks.tasks.list({
						tasklist: resp.items[0].id
					});

					request.execute(function(resp) {
						for(var i = 0; i < resp.items.length; i++) {
							console.log(resp.items[i]);
						}
					});
				});


			});
		}


	</script>
	<script src="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
</body>
</html>